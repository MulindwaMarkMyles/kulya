{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="{% static 'css/main.css' %}">
        <link rel="stylesheet" href="{% static 'css/index.css' %}">
        {% if title == "PRODUCT" %}
            <link rel="stylesheet" href="{% static 'css/product.css' %}">
        {% endif %}
        <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" >
        <title>SHOPPIE - {{ title }}</title>
        {% if title == "SIGNUP" %}
        <script defer src="{% static 'js/signup.js' %}"></script>
        {%  endif %}
</head>
<body>
        <div class="searchbar hide" id="searchbar">
            <form action="" method="POST">
                {% csrf_token %}
                <input type="text" name="searchterm" placeholder="Looking for something...">
                <button type="button" id="exitButton">
                    <span></span>
                    <span></span>
                </button>
            </form>
        </div>
        <section id="header">
                <a class="logo" >SHOPPIE</a>
                <div>
                    <ul id="navbar">
                        <li><a {% if title == 'HOME' %} class="active" {% endif %} href="{% url 'home' %}" >Home</a></li>
                        <li><a {% if title == 'SHOP' %} class="active" {% endif %} href="{% url 'shop' %}" >Shop</a></li>
                        <li><a {% if title == 'PROFILE' %} class="active" {% endif %} href="{% url 'profile' %}">Profile</a></li>
                        <li><a {% if title == 'ABOUT' %} class="active" {% endif %} href="{% url 'about' %}">About Us</a></li>
                        {% if not request.user.is_authenticated %}<li><a href="{% url 'login' %}">Log in</a></li>{% endif %}
                        {% if title == 'SHOP' %}<li><a href="#" id="searchButton"><i class="fas fa-search"></i></a></li>{% endif %}
                        <li><a {% if title == 'CART' or title == 'CHECKOUT' %} class="active" {% endif %} href="{% url 'cart' %}"><i class="icon far fa-shopping-bag">
                            <span id="cart-total">{{ cartItems }}</span>
                        </i></a></li>
                    </ul>
                </div>
    </section>
    <div class="cont">{% block content %} {% endblock content %}</div>
  
    <script src="{% static 'js/cart.js' %}" type="text/javascript"></script>
    <script type="text/javascript">
      var user = "{{ request.user }}";

      function getToken(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== "") {
          const cookies = document.cookie.split(";");
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === name + "=") {
              cookieValue = decodeURIComponent(
                cookie.substring(name.length + 1)
              );
              break;
            }
          }
        }
        return cookieValue;
      }
      const csrftoken = getToken("csrftoken");

      function getCookie(name) {
        var cookieArr = document.cookie.split(";");
        for (var i = 0; i < cookieArr.length; i++) {
          var cookiePair = cookieArr[i].split("=");

          if (name == cookiePair[0].trim()) {
            return decodeURIComponent(cookiePair[1]);
          }
        }
        return null;
      }

      var cart = JSON.parse(getCookie("cart"));
      if (cart == undefined) {
        cart = {};
        console.log("Cart was created:", cart);
        document.cookie = "cart=" + JSON.stringify(cart) + ";domain=;path=/";
      }
      
      var searchbar = document.getElementById("searchbar")
      var exitButton = document.getElementById("exitButton")
      var searchButton = document.getElementById("searchButton")
      
      searchButton.addEventListener('click', function () {
        searchbar.classList.remove("hide")
      })
      
      exitButton.addEventListener('click', function () {
        searchbar.classList.add("hide")
      })
      
    </script>
  </body>
</html>
